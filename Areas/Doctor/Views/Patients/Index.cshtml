@model IEnumerable<MediCare.Models.Patient>

@{
    ViewData["Title"] = "Patients";
    Layout = "~/Areas/Doctor/Views/Shared/_Layout.cshtml";
}

<div class="max-w-7xl mx-auto p-6">
    <!-- 🌿 Header -->
    <div class="flex items-center justify-between mb-8">
        <div>
            <h1 class="page-title">👥 My Patients</h1>
            <p class="page-subtitle">View and manage patients under your care.</p>
        </div>
    </div>

    <!-- ✅ Alerts -->
    @if (TempData["Message"] != null)
    {
        <div class="bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg shadow-sm mb-4">
            @TempData["Message"]
        </div>
    }

    <!-- 🩺 Patient Table -->
    @if (!Model.Any())
    {
        <div class="bg-white rounded-2xl shadow p-10 text-center">
            <h3 class="text-lg font-semibold text-gray-700">No Patients Yet</h3>
            <p class="text-gray-500 text-sm mt-1">You currently have no registered patients.</p>
        </div>
    }
    else
    {
        <div class="card overflow-hidden">
            <table class="min-w-full border-collapse">
                <thead class="bg-brand-50 text-brand-800 text-sm uppercase">
                    <tr>
                        <th class="px-5 py-3 text-left font-semibold">Name</th>
                        <th class="px-5 py-3 text-left font-semibold">Email</th>
                        <th class="px-5 py-3 text-left font-semibold">Phone</th>
                        <th class="px-5 py-3 text-left font-semibold">Last Appointment</th>
                        <th class="px-5 py-3 text-center font-semibold">Actions</th>
                    </tr>
                </thead>

                <tbody class="divide-y divide-gray-100 text-sm">
                    @foreach (var patient in Model)
                    {
                        <tr class="hover:bg-gray-50 transition">
                            <td class="px-5 py-4 font-medium text-gray-800">
                                @patient.AppUser?.FullName
                            </td>
                            <td class="px-5 py-4 text-gray-600">
                                @patient.AppUser?.Email
                            </td>
                            <td class="px-5 py-4 text-gray-600">
                                @patient.PhoneNumber
                            </td>
                            <td class="px-5 py-4 text-gray-600">
                                @{
                                    var lastAppt = patient.Appointments?
                                    .OrderByDescending(a => a.DateTime)
                                    .FirstOrDefault();
                                }
                                @if (lastAppt != null)
                                {
                                    @lastAppt.DateTime.ToString("dd MMM yyyy • hh:mm tt")
                                }
                                else
                                {
                                    <span class="text-gray-400">—</span>
                                }
                            </td>

                            <td class="px-5 py-4 text-center">
                                <a href="@Url.Action("Details", "Patients", new { area = "Doctor", id = patient.PatientId })"
                                   class="btn-brand relative z-50">
                                    🔍 View Details
                                </a>

                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>
