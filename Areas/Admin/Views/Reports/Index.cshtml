@{
    ViewData["Title"] = "Analytics & Reports";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<div class="max-w-7xl mx-auto px-6 py-12">
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-12">
        <div>
            <h1 class="text-4xl font-black text-slate-900 tracking-tight">Analytics <span class="text-blue-600">Center</span></h1>
            <p class="text-slate-500 font-medium mt-1">Real-time platform performance and operational data.</p>
        </div>
        <div class="flex items-center gap-4">
            <button class="px-5 py-2.5 bg-white border border-slate-200 text-slate-600 font-bold rounded-xl text-xs uppercase tracking-widest hover:bg-slate-50 transition-all flex items-center gap-2">
                <i data-lucide="download-cloud" class="w-4 h-4"></i> Export Data
            </button>
        </div>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-3 gap-8 mb-12">
        <div class="bg-white rounded-[2.5rem] p-8 border border-slate-100 shadow-xl shadow-slate-900/5 relative overflow-hidden">
            <div class="relative z-10">
                <p class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-1">Lifetime Visits</p>
                <h3 class="text-4xl font-black text-slate-900">@ViewBag.TotalAppointments</h3>
                <div class="mt-4 flex items-center gap-2 text-blue-600">
                    <span class="p-1 bg-blue-50 rounded-md"><i data-lucide="calendar" class="w-3 h-3"></i></span>
                    <span class="text-xs font-bold uppercase tracking-tighter">Total Bookings</span>
                </div>
            </div>
            <i data-lucide="calendar" class="absolute -right-4 -bottom-4 w-24 h-24 text-slate-50"></i>
        </div>

        <div class="bg-white rounded-[2.5rem] p-8 border border-slate-100 shadow-xl shadow-slate-900/5 relative overflow-hidden">
            <div class="relative z-10">
                <p class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-1">Successful Consults</p>
                <h3 class="text-4xl font-black text-green-600">@ViewBag.CompletedCount</h3>
                <div class="mt-4 flex items-center gap-2 text-green-600">
                    <span class="p-1 bg-green-50 rounded-md"><i data-lucide="check-circle" class="w-3 h-3"></i></span>
                    <span class="text-xs font-bold uppercase tracking-tighter">Verified Completion</span>
                </div>
            </div>
            <i data-lucide="award" class="absolute -right-4 -bottom-4 w-24 h-24 text-slate-50"></i>
        </div>

        <div class="bg-slate-900 rounded-[2.5rem] p-8 shadow-2xl relative overflow-hidden">
            <div class="relative z-10">
                <p class="text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] mb-1">New In-Take</p>
                <h3 class="text-4xl font-black text-white">@ViewBag.MonthlyPatients</h3>
                <div class="mt-4 flex items-center gap-2 text-blue-400">
                    <span class="p-1 bg-blue-500/10 rounded-md"><i data-lucide="trending-up" class="w-3 h-3"></i></span>
                    <span class="text-xs font-bold uppercase tracking-tighter">Current Month</span>
                </div>
            </div>
            <i data-lucide="users" class="absolute -right-4 -bottom-4 w-24 h-24 text-white/5"></i>
        </div>
    </div>

    <div class="bg-white rounded-[3rem] border border-slate-200 shadow-xl shadow-slate-900/5 p-10 mb-12">
        <div class="flex items-center justify-between mb-10">
            <h3 class="text-xl font-black text-slate-900 tracking-tight">Appointment Analytics</h3>
            <div class="flex gap-2">
                <span class="px-3 py-1 bg-slate-100 rounded-full text-[10px] font-bold text-slate-500 uppercase">Last 6 Months</span>
            </div>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-5 gap-12">
            <div class="lg:col-span-3">
                <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-6">Volume Trends</p>
                <div class="h-[300px]">
                    <canvas id="monthlyChart"></canvas>
                </div>
            </div>
            <div class="lg:col-span-2">
                <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-6">Status Segmentation</p>
                <div class="h-[300px] flex items-center justify-center">
                    <canvas id="statusChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-6 ml-4">Detailed Data Reports</h3>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">

        <div class="group bg-white rounded-[2rem] p-8 border border-slate-200 shadow-sm hover:shadow-2xl hover:border-blue-200 transition-all duration-500">
            <div class="w-14 h-14 bg-blue-50 rounded-2xl flex items-center justify-center text-blue-600 mb-6 group-hover:bg-blue-600 group-hover:text-white transition-all">
                <i data-lucide="calendar-days" class="w-6 h-6"></i>
            </div>
            <h3 class="text-xl font-black text-slate-900 mb-2">Visits Archive</h3>
            <p class="text-slate-500 text-sm font-medium mb-8 leading-relaxed">Detailed audit of scheduled, cancelled, and attended appointments.</p>
            <a asp-action="Appointments" class="flex items-center justify-center w-full py-4 bg-slate-900 text-white font-black rounded-xl hover:bg-blue-600 transition-all text-xs uppercase tracking-widest">
                Explore Report
            </a>
        </div>

        <div class="group bg-white rounded-[2rem] p-8 border border-slate-200 shadow-sm hover:shadow-2xl hover:border-green-200 transition-all duration-500">
            <div class="w-14 h-14 bg-green-50 rounded-2xl flex items-center justify-center text-green-600 mb-6 group-hover:bg-green-600 group-hover:text-white transition-all">
                <i data-lucide="credit-card" class="w-6 h-6"></i>
            </div>
            <h3 class="text-xl font-black text-slate-900 mb-2">Revenue Streams</h3>
            <p class="text-slate-500 text-sm font-medium mb-8 leading-relaxed">Financial summary including consultation fees and insurance payouts.</p>
            <a asp-action="Payments" class="flex items-center justify-center w-full py-4 bg-slate-900 text-white font-black rounded-xl hover:bg-green-600 transition-all text-xs uppercase tracking-widest">
                Explore Report
            </a>
        </div>

        <div class="group bg-white rounded-[2rem] p-8 border border-slate-200 shadow-sm hover:shadow-2xl hover:border-purple-200 transition-all duration-500">
            <div class="w-14 h-14 bg-purple-50 rounded-2xl flex items-center justify-center text-purple-600 mb-6 group-hover:bg-purple-600 group-hover:text-white transition-all">
                <i data-lucide="users-2" class="w-6 h-6"></i>
            </div>
            <h3 class="text-xl font-black text-slate-900 mb-2">Demographics</h3>
            <p class="text-slate-500 text-sm font-medium mb-8 leading-relaxed">Patient population insights, age distribution, and growth metrics.</p>
            <a asp-action="Patients" class="flex items-center justify-center w-full py-4 bg-slate-900 text-white font-black rounded-xl hover:bg-purple-600 transition-all text-xs uppercase tracking-widest">
                Explore Report
            </a>
        </div>

    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Set Global Defaults
        Chart.defaults.font.family = "'Plus Jakarta Sans', sans-serif";
        Chart.defaults.color = '#94a3b8';

        const monthLabels = @Html.Raw(Json.Serialize(ViewBag.Months));
        const monthData = @Html.Raw(Json.Serialize(ViewBag.MonthCounts));

        const statusLabels = @Html.Raw(Json.Serialize(ViewBag.StatusLabels));
        const statusData = @Html.Raw(Json.Serialize(ViewBag.StatusCounts));

        // Area Chart
        new Chart(document.getElementById('monthlyChart'), {
            type: 'line',
            data: {
                labels: monthLabels,
                datasets: [{
                    label: 'Appointments',
                    data: monthData,
                    borderColor: '#2563eb',
                    backgroundColor: (context) => {
                        const bg = context.chart.ctx.createLinearGradient(0, 0, 0, 400);
                        bg.addColorStop(0, 'rgba(37, 99, 235, 0.1)');
                        bg.addColorStop(1, 'rgba(37, 99, 235, 0)');
                        return bg;
                    },
                    fill: true,
                    tension: 0.4,
                    pointRadius: 4,
                    pointBackgroundColor: '#fff',
                    pointBorderWidth: 3,
                    borderWidth: 3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { grid: { display: false }, border: { display: false } },
                    y: { grid: { color: '#f1f5f9' }, border: { display: false }, beginAtZero: true }
                }
            }
        });

        // Doughnut Chart
        new Chart(document.getElementById('statusChart'), {
            type: 'doughnut',
            data: {
                labels: statusLabels,
                datasets: [{
                    data: statusData,
                    backgroundColor: ['#10b981', '#f59e0b', '#ef4444', '#3b82f6'],
                    borderWidth: 8,
                    borderColor: '#fff',
                    hoverOffset: 15
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { usePointStyle: true, padding: 25, font: { weight: 'bold', size: 10 } }
                    }
                },
                cutout: '70%'
            }
        });
    </script>
}