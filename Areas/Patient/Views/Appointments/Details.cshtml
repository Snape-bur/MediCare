@model MediCare.Models.Appointment
@{
    ViewData["Title"] = "Appointment Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="max-w-5xl mx-auto mt-10 mb-20 px-4">
    <a asp-action="Index" class="inline-flex items-center gap-2 text-sm font-bold text-gray-500 hover:text-blue-700 transition-colors mb-6 group">
        <i class="fa-solid fa-arrow-left group-hover:-translate-x-1 transition-transform"></i>
        Back to Appointments
    </a>

    <div class="bg-white rounded-3xl shadow-xl border border-gray-100 overflow-hidden">
        <div class="bg-gradient-to-r from-blue-900 to-blue-700 px-10 py-12 text-white relative">
            <div class="relative z-10">
                <div class="flex items-center gap-4 mb-2">
                    <span class="px-3 py-1 bg-white/20 backdrop-blur-md rounded-lg text-xs font-black uppercase tracking-widest border border-white/30">
                        Ref: #@Model.AppointmentId
                    </span>
                    @{
                        var statusStyles = Model.Status.ToLower() switch
                        {
                            "pending" => "bg-amber-400 text-amber-950",
                            "confirmed" => "bg-emerald-400 text-emerald-950",
                            "paid" => "bg-sky-400 text-sky-950",
                            "completed" => "bg-white text-blue-900",
                            _ => "bg-rose-400 text-rose-950"
                        };
                    }
                    <span class="px-3 py-1 @statusStyles rounded-lg text-xs font-black uppercase tracking-widest shadow-sm">
                        @Model.Status
                    </span>
                </div>
                <h1 class="text-4xl font-black tracking-tight">Consultation Details</h1>
                <p class="text-blue-100 mt-2 font-medium opacity-80">Full summary of your visit and medical records.</p>
            </div>
            <i class="fa-solid fa-notes-medical absolute -bottom-4 -right-4 text-9xl text-white/10 rotate-12"></i>
        </div>

        <div class="p-10">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">

                <div class="lg:col-span-2 space-y-10">

                    <section class="grid md:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-[10px] font-black uppercase tracking-[0.2em] text-gray-400 mb-4 flex items-center gap-2">
                                <i class="fa-solid fa-user-doctor text-blue-600"></i> Healthcare Provider
                            </h3>
                            <div class="flex items-center gap-4">
                                <div class="h-14 w-14 rounded-2xl bg-blue-50 flex items-center justify-center text-blue-700 text-xl font-bold border border-blue-100">
                                    @Model.Doctor.AppUser.FullName.Substring(0, 1)
                                </div>
                                <div>
                                    <p class="font-black text-gray-900 text-lg">@Model.Doctor.AppUser.FullName</p>
                                    <p class="text-sm text-gray-500 font-bold">@Model.Doctor.Specialty.Name</p>
                                    <p class="text-xs text-gray-400">@Model.Doctor.Clinic?.Name</p>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h3 class="text-[10px] font-black uppercase tracking-[0.2em] text-gray-400 mb-4 flex items-center gap-2">
                                <i class="fa-solid fa-clock text-blue-600"></i> Scheduled Time
                            </h3>
                            <div class="bg-gray-50 rounded-2xl p-4 border border-gray-100">
                                <p class="text-gray-900 font-black">@Model.DateTime.ToString("dddd, dd MMM yyyy")</p>
                                <p class="text-blue-600 font-bold text-sm">@Model.DateTime.ToString("hh:mm tt")</p>
                            </div>
                        </div>
                    </section>

                    <section class="space-y-6">
                        <h3 class="text-[10px] font-black uppercase tracking-[0.2em] text-gray-400 mb-2">Medical Documentation</h3>

                        @if (!string.IsNullOrEmpty(Model.Notes) || !string.IsNullOrEmpty(Model.Prescription))
                        {
                            @if (!string.IsNullOrEmpty(Model.Notes))
                            {
                                <div class="bg-white border border-gray-200 p-6 rounded-2xl shadow-sm relative group overflow-hidden">
                                    <div class="absolute top-0 left-0 w-1 h-full bg-blue-600"></div>
                                    <h4 class="font-black text-gray-900 text-sm mb-3 flex items-center gap-2">
                                        <i class="fa-solid fa-clipboard-list text-blue-600"></i> Consultation Notes
                                    </h4>
                                    <p class="text-gray-600 leading-relaxed text-sm whitespace-pre-line">@Model.Notes</p>
                                </div>
                            }

                            @if (!string.IsNullOrEmpty(Model.Prescription))
                            {
                                <div class="bg-blue-50/50 border border-blue-100 p-6 rounded-2xl shadow-sm relative overflow-hidden">
                                    <h4 class="font-black text-blue-900 text-sm mb-3 flex items-center gap-2">
                                        <i class="fa-solid fa-pills text-blue-600"></i> Digital Prescription
                                    </h4>
                                    <p class="text-gray-700 leading-relaxed text-sm font-medium whitespace-pre-line">@Model.Prescription</p>
                                    <i class="fa-solid fa-prescription absolute -bottom-4 -right-2 text-6xl text-blue-600/5"></i>
                                </div>
                            }
                        }
                        else
                        {
                            <div class="text-center py-10 bg-gray-50 rounded-2xl border border-dashed border-gray-200">
                                <i class="fa-solid fa- hourglass text-gray-300 text-2xl mb-2"></i>
                                <p class="text-gray-500 text-sm italic font-medium">Medical records will be available after the consultation is completed.</p>
                            </div>
                        }
                    </section>
                </div>

                <div class="space-y-6">
                    <div class="bg-white rounded-3xl border border-gray-100 shadow-xl shadow-blue-900/5 overflow-hidden">
                        <div class="p-6 border-b border-gray-50">
                            <h3 class="text-[10px] font-black uppercase tracking-widest text-gray-400">Payment Summary</h3>
                        </div>
                        <div class="p-6 space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-500 font-bold">Consultation Fee</span>
                                <span class="text-xl font-black text-gray-900">@Model.Fee.ToString("C")</span>
                            </div>

                            @if (Model.Payment != null)
                            {
                                <div class="pt-4 border-t border-gray-50 space-y-3">
                                    <div class="flex justify-between text-xs font-bold">
                                        <span class="text-gray-400 uppercase">Method</span>
                                        <span class="text-gray-900">@Model.Payment.Method</span>
                                    </div>
                                    <div class="flex justify-between text-xs font-bold">
                                        <span class="text-gray-400 uppercase">Status</span>
                                        <span class="text-emerald-600 flex items-center gap-1">
                                            <i class="fa-solid fa-circle-check"></i> @Model.Payment.Status
                                        </span>
                                    </div>
                                    <div class="p-3 bg-gray-50 rounded-xl">
                                        <p class="text-[9px] font-black text-gray-400 uppercase mb-1 tracking-tighter">Transaction ID</p>
                                        <p class="text-[11px] font-mono text-gray-600 break-all">@Model.Payment.TransactionId</p>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>

                    <div class="space-y-3">
                        @if (Model.Status.Equals("Paid", StringComparison.OrdinalIgnoreCase))
                        {
                            <a asp-action="DownloadReceipt" asp-route-id="@Model.AppointmentId"
                               class="flex items-center justify-center gap-2 w-full py-4 bg-emerald-600 text-white rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-emerald-700 transition-all shadow-lg shadow-emerald-100">
                                <i class="fa-solid fa-file-invoice"></i> Download Receipt
                            </a>
                        }

                        @if (Model.Status.Equals("Completed", StringComparison.OrdinalIgnoreCase) && !string.IsNullOrEmpty(Model.Prescription))
                        {
                            <a asp-action="DownloadPrescription" asp-route-id="@Model.AppointmentId"
                               class="flex items-center justify-center gap-2 w-full py-4 bg-brand text-white rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-blue-700 transition-all shadow-lg shadow-blue-100">
                                <i class="fa-solid fa-file-prescription"></i> Get Prescription
                            </a>
                        }

                        <a asp-action="Index" class="flex items-center justify-center gap-2 w-full py-4 text-gray-400 font-bold text-xs uppercase hover:text-gray-900 transition-all">
                            Return to Registry
                        </a>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>